================================================================================
üéØ TRAINING PULLBACK PREDICTION MODEL
================================================================================
Started: 2025-10-05 16:57:17

Target: Predict 5%+ pullback within 5-15 days
Use case: Risk management, timing exits, hedging decisions
================================================================================

üì¶ Initializing trainer...

üì• Loading data...
================================================================================
üì• LOADING DATA
================================================================================
================================================================================
üì• LOADING ALL MARKET DATA
================================================================================
üì• Loading SPY data from 2000-01-01 to 2024-12-31...
üîç Validating data source: yfinance
   üìä Price range: $50.09 - $600.51
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
‚úÖ SPY data loaded: 6288 records
üì• Loading 10 sector ETFs...
   Loading XLU (Utilities)...
üîç Validating data source: yfinance
   ‚ùå Failed to load XLU: ‚ùå FORBIDDEN: Unrealistic price range 6.84-80.56 for SECTOR_ETF (expected 10-500)
   ‚ö†Ô∏è  Continuing without XLU
   Loading XLK (Technology)...
üîç Validating data source: yfinance
   ‚ùå Failed to load XLK: ‚ùå FORBIDDEN: Unrealistic price range 8.64-239.92 for SECTOR_ETF (expected 10-500)
   ‚ö†Ô∏è  Continuing without XLK
   Loading XLV (Healthcare)...
üîç Validating data source: yfinance
   üìä Price range: $14.91 - $153.91
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLV loaded
   Loading XLF (Financials)...
üîç Validating data source: yfinance
   ‚ùå Failed to load XLF: ‚ùå FORBIDDEN: Unrealistic price range 3.71-50.60 for SECTOR_ETF (expected 10-500)
   ‚ö†Ô∏è  Continuing without XLF
   Loading XLE (Energy)...
üîç Validating data source: yfinance
   üìä Price range: $10.51 - $94.14
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLE loaded
   Loading XLI (Industrials)...
üîç Validating data source: yfinance
   üìä Price range: $11.10 - $141.81
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLI loaded
   Loading XLY (Consumer Discretionary)...
üîç Validating data source: yfinance
   üìä Price range: $13.03 - $237.40
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLY loaded
   Loading XLP (Consumer Staples)...
üîç Validating data source: yfinance
   üìä Price range: $10.06 - $81.62
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLP loaded
   Loading XLB (Materials)...
üîç Validating data source: yfinance
   ‚ùå Failed to load XLB: ‚ùå FORBIDDEN: Unrealistic price range 9.79-95.72 for SECTOR_ETF (expected 10-500)
   ‚ö†Ô∏è  Continuing without XLB
   Loading XLRE (Real Estate)...
üîç Validating data source: yfinance
   üìä Price range: $19.51 - $45.64
‚úÖ Data validation passed: 2322 records from 2015-10-08 to 2024-12-30
   ‚úÖ XLRE loaded
‚úÖ Loaded 6/10 sector ETFs
üí± Loading currency data...
   Loading USDJPY (JPY=X)...
üîç Validating data source: yfinance
   üìä Price range: $75.74 - $161.62
‚úÖ Data validation passed: 6492 records from 2000-01-03 to 2024-12-30
   ‚úÖ USDJPY loaded
   Loading EURUSD (EURUSD=X)...
üîç Validating data source: yfinance
   üìä Price range: $0.96 - $1.60
‚úÖ Data validation passed: 5472 records from 2003-12-01 to 2024-12-30
   ‚úÖ EURUSD loaded
   Loading DXY (UUP)...
üîç Validating data source: yfinance
   üìä Price range: $18.08 - $29.37
‚úÖ Data validation passed: 4490 records from 2007-03-01 to 2024-12-30
   ‚úÖ DXY loaded
‚úÖ Loaded 3/3 currency pairs
üìä Loading volatility data...
   Loading VIX (^VIX)...
üîç Validating data source: yfinance
   üìä Price range: $9.14 - $82.69
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ VIX loaded
   Loading VIX9D (^VIX9D)...
üîç Validating data source: yfinance
   üìä Price range: $7.10 - $106.66
‚úÖ Data validation passed: 3521 records from 2011-01-03 to 2024-12-30
   ‚úÖ VIX9D loaded
   Loading VVIX (^VVIX)...
üîç Validating data source: yfinance
   üìä Price range: $59.74 - $207.59
‚úÖ Data validation passed: 4520 records from 2007-01-03 to 2024-12-30
   ‚úÖ VVIX loaded
‚úÖ Loaded 3/3 volatility indices
================================================================================
‚úÖ ALL DATA LOADED SUCCESSFULLY
================================================================================

üîß Engineering features...

================================================================================
üîß FEATURE ENGINEERING
================================================================================
================================================================================
üîß CALCULATING FEATURES
================================================================================
Feature sets: baseline, currency, volatility, sectors
üìä Calculating baseline features...
   ‚ö†Ô∏è  Sector data incomplete, skipping sector rotation features
   ‚úÖ Baseline features: 5
üí± Calculating currency features...
   ‚úÖ Currency features: 12
üìä Calculating volatility features...
   ‚úÖ Volatility features: 19
üßπ Cleaning features...
   Dropped 20 rows with missing critical features
   ‚úÖ Clean data: 6268 records with 36 features
================================================================================
‚úÖ FEATURE CALCULATION COMPLETE: 36 features
================================================================================
‚úÖ Created 36 features

üéØ Creating pullback prediction target...
üéØ Creating Pullback Prediction Target
   Pullback threshold: 5.0%
   Lookforward window: 5-15 days

üéØ PULLBACK PREDICTION TARGET CREATED
   Total samples: 6273
   Pullback events: 1091 (17.4%)
   No pullback: 5182 (82.6%)
   Class balance: 0.21

üîó Merging features and target...
‚úÖ Combined data: 6253 records
   Features: 36
   Target: pullback_prediction_target
   Positive rate: 17.3%

‚úÇÔ∏è  Splitting data...

================================================================================
‚úÇÔ∏è  DATA SPLITTING
================================================================================
üìä Splitting data: Train ‚â§ 2022-12-31, Val ‚â§ 2023-12-31, Test > 2023-12-31
   Train: 5767 records (2000-02-01 to 2022-12-30)
   Val:   250 records (2023-01-03 to 2023-12-29)
   Test:  236 records (2024-01-02 to 2024-12-06)
   Train: 5767 records
   Val:   250 records
   Test:  236 records

üìä Training set class distribution:
   No pullback: 4727 (82.0%)
   Pullback:    1040 (18.0%)

================================================================================
üéì TRAINING MODEL
================================================================================
üéì Training ensemble model...
   Features: 36
   Training samples: 5767
   Positive rate: 18.03%
‚úÖ Model trained successfully

‚úÖ Model trained successfully!

================================================================================
üìä VALIDATION SET PERFORMANCE
================================================================================

Classification Report:
              precision    recall  f1-score   support

 No Pullback       0.91      0.73      0.81       224
    Pullback       0.14      0.38      0.21        26

    accuracy                           0.70       250
   macro avg       0.53      0.56      0.51       250
weighted avg       0.83      0.70      0.75       250


Confusion Matrix:
[[164  60]
 [ 16  10]]

True Negatives:  164 (correctly predicted no pullback)
False Positives: 60 (false alarm)
False Negatives: 16 (missed pullback)
True Positives:  10 (correctly predicted pullback)

üéØ ROC AUC Score: 0.5975

================================================================================
üìä TEST SET PERFORMANCE (2024)
================================================================================

Classification Report:
              precision    recall  f1-score   support

 No Pullback       0.92      0.71      0.80       221
    Pullback       0.03      0.13      0.05        15

    accuracy                           0.67       236
   macro avg       0.48      0.42      0.42       236
weighted avg       0.87      0.67      0.75       236


Confusion Matrix:
[[156  65]
 [ 13   2]]

True Negatives:  156 (correctly predicted no pullback)
False Positives: 65 (false alarm - predicted pullback but didn't happen)
False Negatives: 13 (missed pullback - didn't predict but happened)
True Positives:  2 (correctly predicted pullback)

üéØ ROC AUC Score: 0.3716
üéØ Precision: 0.0299 (when model predicts pullback, how often is it right?)
üéØ Recall: 0.1333 (of all actual pullbacks, how many did we catch?)

================================================================================
üîç DETAILED TEST SET ANALYSIS
================================================================================

üìà HIGH CONFIDENCE PULLBACK PREDICTIONS (>70%):

Found 9 high-confidence predictions:
  2024-09-09: 76.9% confidence - ‚ùå FALSE ALARM
    SPY: $538.20
  2024-09-10: 75.6% confidence - ‚ùå FALSE ALARM
    SPY: $540.54
  2024-03-11: 74.0% confidence - ‚ùå FALSE ALARM
    SPY: $500.42
  2024-09-26: 72.4% confidence - ‚ùå FALSE ALARM
    SPY: $565.43
  2024-04-11: 71.1% confidence - ‚ùå FALSE ALARM
    SPY: $508.57
  2024-08-22: 70.5% confidence - ‚ùå FALSE ALARM
    SPY: $547.86
  2024-08-27: 70.4% confidence - ‚ùå FALSE ALARM
    SPY: $553.12
  2024-09-27: 70.3% confidence - ‚ùå FALSE ALARM
    SPY: $564.61
  2024-02-28: 70.3% confidence - ‚ùå FALSE ALARM
    SPY: $495.51

‚ö†Ô∏è  MISSED PULLBACKS (actual pullback but low prediction):

Missed 13 pullbacks:
  2024-03-28: 25.5% confidence (missed)
    SPY: $513.55
  2024-04-01: 17.9% confidence (missed)
    SPY: $512.66
  2024-07-12: 19.1% confidence (missed)
    SPY: $551.57
  2024-07-15: 19.1% confidence (missed)
    SPY: $553.09
  2024-07-16: 19.4% confidence (missed)
    SPY: $556.37

================================================================================
üíæ SAVING MODEL
================================================================================
üíæ Model saved: models/trained/pullback_prediction_ensemble_20251005.pkl/ensemble_model.pkl
üíæ Features saved: models/trained/pullback_prediction_ensemble_20251005.pkl/feature_columns.json
üíæ Metadata saved: models/trained/pullback_prediction_ensemble_20251005.pkl/model_metadata.json
‚úÖ Saved: models/trained/pullback_prediction_ensemble_20251005.pkl

================================================================================
‚úÖ TRAINING COMPLETE
================================================================================

Model: Pullback Prediction (5%+ in 5-15 days)
Type: Ensemble (Random Forest + XGBoost)
Features: 36

Test Performance:
  ROC AUC:   37.2%
  Precision: 3.0%
  Recall:    13.3%

Saved: models/trained/pullback_prediction_ensemble_20251005.pkl
================================================================================

üéâ SUCCESS!
üéØ Model achieved 37.2% ROC AUC on 2024 test data
