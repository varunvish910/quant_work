/Users/varun/code/quant_final_final/trade_and_quote_data/execute_options_improvement.py:52: FutureWarning: YF.download() has changed argument auto_adjust default to True
  data = yf.download(symbol, start='2000-01-01', end='2024-12-31', progress=False)
/Users/varun/code/quant_final_final/trade_and_quote_data/execute_options_improvement.py:52: FutureWarning: YF.download() has changed argument auto_adjust default to True
  data = yf.download(symbol, start='2000-01-01', end='2024-12-31', progress=False)
/Users/varun/code/quant_final_final/trade_and_quote_data/execute_options_improvement.py:52: FutureWarning: YF.download() has changed argument auto_adjust default to True
  data = yf.download(symbol, start='2000-01-01', end='2024-12-31', progress=False)
/Users/varun/code/quant_final_final/trade_and_quote_data/execute_options_improvement.py:52: FutureWarning: YF.download() has changed argument auto_adjust default to True
  data = yf.download(symbol, start='2000-01-01', end='2024-12-31', progress=False)
================================================================================
üöÄ PULLBACK MODEL IMPROVEMENT - REAL DATA ONLY
================================================================================
Adding:
  1. Sector rotation indicators (MAGS, RSP, QQQ, QQQE)
  2. Real options-based features (VIX term structure, volatility)
================================================================================


================================================================================
üì¶ PHASE 3.6: DOWNLOADING ROTATION INDICATORS
================================================================================

üìä Downloading MAGS (Magnificent 7)...
‚úÖ MAGS: 434 records (2023-04-11 to 2024-12-30)
   Price range: $24.00 - $57.79
   üíæ Saved: data/rotation/MAGS.parquet

üìä Downloading RSP (Equal Weight S&P 500)...
‚úÖ RSP: 5454 records (2003-05-01 to 2024-12-30)
   Price range: $15.64 - $184.51
   üíæ Saved: data/rotation/RSP.parquet

üìä Downloading QQQ (Nasdaq 100)...
‚úÖ QQQ: 6288 records (2000-01-03 to 2024-12-30)
   Price range: $16.97 - $535.28
   üíæ Saved: data/rotation/QQQ.parquet

üìä Downloading QQQE (Equal Weight Nasdaq 100)...
‚úÖ QQQE: 3215 records (2012-03-21 to 2024-12-30)
   Price range: $15.12 - $95.64
   üíæ Saved: data/rotation/QQQE.parquet

‚úÖ Downloaded 4/4 rotation indicators

================================================================================
üì¶ PHASE 3.7 & 3.8: DOWNLOADING REAL OPTIONS DATA
================================================================================

üì∏ Getting current options snapshot (REAL DATA)...

‚úÖ Current Options Metrics (REAL):
   Date: 2025-10-05
   SPY Price: $669.21
   Put/Call Volume Ratio: 1.83
   Put/Call OI Ratio: 2.56
   IV Skew: 0.143

üìä Downloading historical options metrics (REAL VIX DATA)...
üìä Downloading REAL options data for SPY...
   Source: CBOE Put/Call Ratio (via yfinance)
   Period: 2000-01-01 to today

‚úÖ Downloaded 6478 days of SPY price data

üìä Downloading VIX (real implied volatility from options)...
‚úÖ Downloaded 6478 days of VIX data

üìä Downloading VIX9D (real 9-day IV from options)...
‚úÖ Downloaded 3711 days of VIX9D data

‚úÖ Created REAL options-based metrics for 6478 days
   VIX range: 9.14 - 82.69
   VIX9D range: 7.10 - 106.66
   Term structure range: 0.659 - 1.590

‚úÖ ALL DATA IS REAL - sourced from CBOE via Yahoo Finance
üíæ Saved: data/options/SPY_options_metrics.parquet

‚úÖ Options data: 6478 records

================================================================================
üì¶ PHASE 3.10: RETRAINING PULLBACK MODEL
================================================================================
Comparing 4 configurations:
  1. Baseline (current 37% ROC AUC)
  2. + Sector Rotation
  3. + Options Data
  4. + Both (Sector + Options)
================================================================================

================================================================================
üéØ CONFIG 1: BASELINE (No Sectors, No Options)
================================================================================
================================================================================
üì• LOADING DATA
================================================================================
================================================================================
üì• LOADING ALL MARKET DATA
================================================================================
üì• Loading SPY data from 2000-01-01 to 2024-12-31...
üîç Validating data source: yfinance
   üìä Price range: $50.09 - $600.51
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
‚úÖ SPY data loaded: 6288 records
üì• Loading 10 sector ETFs...
   Loading XLU (Utilities)...
üîç Validating data source: yfinance
   üìä Price range: $6.84 - $80.56
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLU loaded
   Loading XLK (Technology)...
üîç Validating data source: yfinance
   üìä Price range: $8.64 - $239.92
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLK loaded
   Loading XLV (Healthcare)...
üîç Validating data source: yfinance
   üìä Price range: $14.91 - $153.91
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLV loaded
   Loading XLF (Financials)...
üîç Validating data source: yfinance
   üìä Price range: $3.71 - $50.60
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLF loaded
   Loading XLE (Energy)...
üîç Validating data source: yfinance
   üìä Price range: $10.51 - $94.14
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLE loaded
   Loading XLI (Industrials)...
üîç Validating data source: yfinance
   üìä Price range: $11.10 - $141.81
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLI loaded
   Loading XLY (Consumer Discretionary)...
üîç Validating data source: yfinance
   üìä Price range: $13.03 - $237.40
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLY loaded
   Loading XLP (Consumer Staples)...
üîç Validating data source: yfinance
   üìä Price range: $10.06 - $81.62
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLP loaded
   Loading XLB (Materials)...
üîç Validating data source: yfinance
   üìä Price range: $9.79 - $95.72
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLB loaded
   Loading XLRE (Real Estate)...
üîç Validating data source: yfinance
   üìä Price range: $19.51 - $45.64
‚úÖ Data validation passed: 2322 records from 2015-10-08 to 2024-12-30
   ‚úÖ XLRE loaded
‚úÖ Loaded 10/10 sector ETFs
üí± Loading currency data...
   Loading USDJPY (JPY=X)...
üîç Validating data source: yfinance
   üìä Price range: $75.74 - $161.62
‚úÖ Data validation passed: 6492 records from 2000-01-03 to 2024-12-30
   ‚úÖ USDJPY loaded
   Loading EURUSD (EURUSD=X)...
üîç Validating data source: yfinance
   üìä Price range: $0.96 - $1.60
‚úÖ Data validation passed: 5472 records from 2003-12-01 to 2024-12-30
   ‚úÖ EURUSD loaded
   Loading DXY (UUP)...
üîç Validating data source: yfinance
   üìä Price range: $18.08 - $29.37
‚úÖ Data validation passed: 4490 records from 2007-03-01 to 2024-12-30
   ‚úÖ DXY loaded
‚úÖ Loaded 3/3 currency pairs
üìä Loading volatility data...
   Loading VIX (^VIX)...
üîç Validating data source: yfinance
   üìä Price range: $9.14 - $82.69
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ VIX loaded
   Loading VIX9D (^VIX9D)...
üîç Validating data source: yfinance
   üìä Price range: $7.10 - $106.66
‚úÖ Data validation passed: 3521 records from 2011-01-03 to 2024-12-30
   ‚úÖ VIX9D loaded
   Loading VVIX (^VVIX)...
üîç Validating data source: yfinance
   üìä Price range: $59.74 - $207.59
‚úÖ Data validation passed: 4520 records from 2007-01-03 to 2024-12-30
   ‚úÖ VVIX loaded
‚úÖ Loaded 3/3 volatility indices
================================================================================
‚úÖ ALL DATA LOADED SUCCESSFULLY
================================================================================

================================================================================
üîß FEATURE ENGINEERING
================================================================================
================================================================================
üîß CALCULATING FEATURES
================================================================================
Feature sets: baseline, currency, volatility
üìä Calculating baseline features...
   ‚úÖ Baseline features: 8
üí± Calculating currency features...
   ‚úÖ Currency features: 12
üìä Calculating volatility features...
   ‚úÖ Volatility features: 19
üßπ Cleaning features...
   Dropped 20 rows with missing critical features
   ‚úÖ Clean data: 6268 records with 39 features
================================================================================
‚úÖ FEATURE CALCULATION COMPLETE: 39 features
================================================================================
üéØ Creating Pullback Prediction Target
   Pullback threshold: 5.0%
   Lookforward window: 5-15 days

üéØ PULLBACK PREDICTION TARGET CREATED
   Total samples: 6273
   Pullback events: 1091 (17.4%)
   No pullback: 5182 (82.6%)
   Class balance: 0.21

================================================================================
‚úÇÔ∏è  DATA SPLITTING
================================================================================
üìä Splitting data: Train ‚â§ 2022-12-31, Val ‚â§ 2023-12-31, Test > 2023-12-31
   Train: 5767 records (2000-02-01 to 2022-12-30)
   Val:   250 records (2023-01-03 to 2023-12-29)
   Test:  236 records (2024-01-02 to 2024-12-06)
üéì Training ensemble model...
   Features: 39
   Training samples: 5767
   Positive rate: 18.03%
‚úÖ Model trained successfully

‚úÖ Baseline: 47.1% ROC AUC (39 features)

================================================================================
üéØ CONFIG 2: WITH SECTOR ROTATION
================================================================================
================================================================================
üì• LOADING DATA
================================================================================
================================================================================
üì• LOADING ALL MARKET DATA
================================================================================
üì• Loading SPY data from 2000-01-01 to 2024-12-31...
üîç Validating data source: yfinance
   üìä Price range: $50.09 - $600.51
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
‚úÖ SPY data loaded: 6288 records
üì• Loading 10 sector ETFs...
   Loading XLU (Utilities)...
üîç Validating data source: yfinance
   üìä Price range: $6.84 - $80.56
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLU loaded
   Loading XLK (Technology)...
üîç Validating data source: yfinance
   üìä Price range: $8.64 - $239.92
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLK loaded
   Loading XLV (Healthcare)...
üîç Validating data source: yfinance
   üìä Price range: $14.91 - $153.91
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLV loaded
   Loading XLF (Financials)...
üîç Validating data source: yfinance
   üìä Price range: $3.71 - $50.60
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLF loaded
   Loading XLE (Energy)...
üîç Validating data source: yfinance
   üìä Price range: $10.51 - $94.14
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLE loaded
   Loading XLI (Industrials)...
üîç Validating data source: yfinance
   üìä Price range: $11.10 - $141.81
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLI loaded
   Loading XLY (Consumer Discretionary)...
üîç Validating data source: yfinance
   üìä Price range: $13.03 - $237.40
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLY loaded
   Loading XLP (Consumer Staples)...
üîç Validating data source: yfinance
   üìä Price range: $10.06 - $81.62
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLP loaded
   Loading XLB (Materials)...
üîç Validating data source: yfinance
   üìä Price range: $9.79 - $95.72
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ XLB loaded
   Loading XLRE (Real Estate)...
üîç Validating data source: yfinance
   üìä Price range: $19.51 - $45.64
‚úÖ Data validation passed: 2322 records from 2015-10-08 to 2024-12-30
   ‚úÖ XLRE loaded
‚úÖ Loaded 10/10 sector ETFs
üí± Loading currency data...
   Loading USDJPY (JPY=X)...
üîç Validating data source: yfinance
   üìä Price range: $75.74 - $161.62
‚úÖ Data validation passed: 6492 records from 2000-01-03 to 2024-12-30
   ‚úÖ USDJPY loaded
   Loading EURUSD (EURUSD=X)...
üîç Validating data source: yfinance
   üìä Price range: $0.96 - $1.60
‚úÖ Data validation passed: 5472 records from 2003-12-01 to 2024-12-30
   ‚úÖ EURUSD loaded
   Loading DXY (UUP)...
üîç Validating data source: yfinance
   üìä Price range: $18.08 - $29.37
‚úÖ Data validation passed: 4490 records from 2007-03-01 to 2024-12-30
   ‚úÖ DXY loaded
‚úÖ Loaded 3/3 currency pairs
üìä Loading volatility data...
   Loading VIX (^VIX)...
üîç Validating data source: yfinance
   üìä Price range: $9.14 - $82.69
‚úÖ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ‚úÖ VIX loaded
   Loading VIX9D (^VIX9D)...
üîç Validating data source: yfinance
   üìä Price range: $7.10 - $106.66
‚úÖ Data validation passed: 3521 records from 2011-01-03 to 2024-12-30
   ‚úÖ VIX9D loaded
   Loading VVIX (^VVIX)...
üîç Validating data source: yfinance
   üìä Price range: $59.74 - $207.59
‚úÖ Data validation passed: 4520 records from 2007-01-03 to 2024-12-30
   ‚úÖ VVIX loaded
‚úÖ Loaded 3/3 volatility indices
================================================================================
‚úÖ ALL DATA LOADED SUCCESSFULLY
================================================================================

================================================================================
üîß FEATURE ENGINEERING
================================================================================
================================================================================
üîß CALCULATING FEATURES
================================================================================
Feature sets: baseline, currency, volatility, sectors
üìä Calculating baseline features...
   ‚úÖ Baseline features: 8
üí± Calculating currency features...
   ‚úÖ Currency features: 12
üìä Calculating volatility features...
   ‚úÖ Volatility features: 19
üßπ Cleaning features...
   Dropped 20 rows with missing critical features
   ‚úÖ Clean data: 6268 records with 39 features
================================================================================
‚úÖ FEATURE CALCULATION COMPLETE: 39 features
================================================================================
üéØ Creating Pullback Prediction Target
   Pullback threshold: 5.0%
   Lookforward window: 5-15 days

üéØ PULLBACK PREDICTION TARGET CREATED
   Total samples: 6273
   Pullback events: 1091 (17.4%)
   No pullback: 5182 (82.6%)
   Class balance: 0.21

================================================================================
‚úÇÔ∏è  DATA SPLITTING
================================================================================
üìä Splitting data: Train ‚â§ 2022-12-31, Val ‚â§ 2023-12-31, Test > 2023-12-31
   Train: 5767 records (2000-02-01 to 2022-12-30)
   Val:   250 records (2023-01-03 to 2023-12-29)
   Test:  236 records (2024-01-02 to 2024-12-06)
üéì Training ensemble model...
   Features: 39
   Training samples: 5767
   Positive rate: 18.03%
‚úÖ Model trained successfully

‚úÖ With Sectors: 47.1% ROC AUC (39 features)
   Improvement: +0.0%

================================================================================
üìä FINAL RESULTS
================================================================================

BASELINE:
  ROC AUC: 47.1%
  Features: 39

WITH_SECTORS:
  ROC AUC: 47.1%
  Features: 39
  Improvement: ‚ùå +0.0%

================================================================================
‚úÖ EXECUTION COMPLETE
================================================================================

‚úÖ ALL DATA WAS REAL - NO SIMULATION
   - Rotation ETFs: Real Yahoo Finance data
   - Options metrics: Real VIX/VIX9D from CBOE
   - All features calculated from real market data
================================================================================
