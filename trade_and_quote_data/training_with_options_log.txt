
1 Failed download:
['JPY=X']: Timeout('Failed to perform, curl: (28) Connection timed out after 10001 milliseconds. See https://curl.se/libcurl/c/libcurl-errors.html first for more details.')
================================================================================
ğŸ¯ TRAINING EARLY WARNING MODEL WITH OPTIONS FEATURES
================================================================================

================================================================================
STEP 1: LOADING DATA
================================================================================

ğŸ“Š Loading SPY data...
ğŸ“¥ Loading SPY data from 2016-01-01 to 2024-12-31...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $155.44 - $600.51
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
âœ… SPY data loaded: 2263 records
âœ… Loaded 2263 days of SPY data

ğŸ“Š Loading sector data...
ğŸ“¥ Loading 10 sector ETFs...
   Loading XLU (Utilities)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $31.52 - $80.56
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… XLU loaded
   Loading XLK (Technology)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $34.66 - $239.92
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… XLK loaded
   Loading XLV (Healthcare)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $54.01 - $153.91
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… XLV loaded
   Loading XLF (Financials)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $13.30 - $50.60
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… XLF loaded
   Loading XLE (Energy)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $18.77 - $94.14
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… XLE loaded
   Loading XLI (Industrials)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $40.34 - $141.81
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… XLI loaded
   Loading XLY (Consumer Discretionary)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $61.66 - $237.40
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… XLY loaded
   Loading XLP (Consumer Staples)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $37.25 - $81.62
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… XLP loaded
   Loading XLB (Materials)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $30.68 - $95.72
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… XLB loaded
   Loading XLRE (Real Estate)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $19.51 - $45.64
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… XLRE loaded
âœ… Loaded 10/10 sector ETFs
ğŸ“¥ Loading 4 rotation indicators...
   Loading MAGS (Magnificent 7)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $24.00 - $57.79
âœ… Data validation passed: 434 records from 2023-04-11 to 2024-12-30
   âœ… MAGS loaded
   Loading RSP (Equal Weight S&P 500)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $57.67 - $184.51
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… RSP loaded
   Loading QQQ (Nasdaq 100)...
ğŸ” Validating data source: yfinance
   âŒ Failed to load QQQ: âŒ FORBIDDEN: Unrealistic price range 89.70-535.28 for ROTATION_ETF (expected 10-500)
   âš ï¸  Continuing without QQQ
   Loading QQQE (Equal Weight Nasdaq 100)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $24.59 - $95.64
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… QQQE loaded
âœ… Loaded 3/4 rotation indicators
âœ… Loaded 13 sector ETFs

ğŸ“Š Loading currency data...
ğŸ’± Loading currency data...
   Loading USDJPY (JPY=X)...
ğŸ” Validating data source: yfinance
   âŒ Failed to load USDJPY: âŒ FORBIDDEN: Empty dataset
   ğŸš¨ WARNING: USD/JPY is critical for July 2024 detection!
   âš ï¸  Continuing without USDJPY
   Loading EURUSD (EURUSD=X)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $0.96 - $1.25
âœ… Data validation passed: 2344 records from 2016-01-01 to 2024-12-30
   âœ… EURUSD loaded
   Loading DXY (UUP)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $20.00 - $29.37
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… DXY loaded
âœ… Loaded 2/3 currency pairs
âœ… Loaded 2 currency pairs

ğŸ“Š Loading volatility data...
ğŸ“Š Loading volatility data...
   Loading VIX (^VIX)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $9.14 - $82.69
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… VIX loaded
   Loading VIX9D (^VIX9D)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $7.10 - $106.66
âœ… Data validation passed: 2263 records from 2016-01-04 to 2024-12-30
   âœ… VIX9D loaded
   Loading VVIX (^VVIX)...
ğŸ” Validating data source: yfinance
   ğŸ“Š Price range: $73.26 - $207.59
âœ… Data validation passed: 2255 records from 2016-01-04 to 2024-12-30
   âœ… VVIX loaded
âœ… Loaded 3/3 volatility indices
âœ… Loaded 3 volatility indices

ğŸ“Š Loading options features...
âœ… Loaded 2264 days of options features
   Features: 33 columns

================================================================================
STEP 2: CREATING FEATURES
================================================================================

ğŸ“Š Creating baseline features...
================================================================================
ğŸ”§ CALCULATING FEATURES
================================================================================
Feature sets: baseline, currency, volatility
ğŸ“Š Calculating baseline features...
   âœ… Rotation indicators: 3 features
   âœ… Regime detection: 11 features
   âœ… Momentum exhaustion: 9 features
   âœ… Baseline features: 31
ğŸ’± Calculating currency features...
   âœ… Currency features: 5
ğŸ“Š Calculating volatility features...
   âœ… Volatility features: 19
ğŸ§¹ Cleaning features...
   Dropped 20 rows with missing critical features
   âœ… Clean data: 2243 records with 55 features
================================================================================
âœ… FEATURE CALCULATION COMPLETE: 55 features
================================================================================
âœ… Created 55 baseline features

ğŸ“Š Merging options features...
âœ… Added 30 new options features
   â„¹ï¸  Skipped 3 duplicate columns: vix_term_structure, vix_backwardation, vix_spike

================================================================================
STEP 3: CREATING TARGET
================================================================================

ğŸ¯ Creating Early Warning Target
   Drawdown threshold: 5.0%
   Lead time: 3-13 days
   Lookforward window: 10 days
ğŸ¯ EARLY_WARNING TARGET CREATED
   Total samples: 2,230
   Positive samples: 408 (18.3%)
   Negative samples: 1,822 (81.7%)
   Class balance: 0.22 (1.0 = perfect balance)
âœ… Target created: early_warning_target

================================================================================
STEP 4: PREPARING TRAINING DATA
================================================================================

ğŸ“Š Total samples: 2230

ğŸ“Š Data splits:
   Train: 1992 samples (2016-02-02 to 2023-12-29)
   Val:   124 samples (2024-01-02 to 2024-06-28)
   Test:  114 samples (2024-07-01 to 2024-12-10)

ğŸ“Š Class balance:
   Train: 19.5% positive
   Val:   0.0% positive
   Test:  17.5% positive

================================================================================
MODEL 1: BASELINE (TECHNICAL FEATURES ONLY)
================================================================================

ğŸ“Š Using 55 baseline features

ğŸ”„ Training baseline model...
Training until validation scores don't improve for 50 rounds
[50]	train's auc: 0.995523	val's auc: 1
Early stopping, best iteration is:
[1]	train's auc: 0.903722	val's auc: 1

ğŸ“Š BASELINE MODEL PERFORMANCE:
================================================================================

Train:
   ROC AUC:   90.4%
   Precision: 0.0%
   Recall:    0.0%
   F1 Score:  0.0%

Val:
   ROC AUC:   nan%
   Precision: 0.0%
   Recall:    0.0%
   F1 Score:  0.0%

Test:
   ROC AUC:   46.0%
   Precision: 0.0%
   Recall:    0.0%
   F1 Score:  0.0%

================================================================================
MODEL 2: ENHANCED (TECHNICAL + OPTIONS)
================================================================================

ğŸ“Š Using 85 features (55 baseline + 30 options)

ğŸ”„ Training enhanced model...
Training until validation scores don't improve for 50 rounds
[50]	train's auc: 0.996574	val's auc: 1
Early stopping, best iteration is:
[1]	train's auc: 0.906265	val's auc: 1

ğŸ“Š ENHANCED MODEL PERFORMANCE:
================================================================================

Train:
   ROC AUC:   90.6%
   Precision: 0.0%
   Recall:    0.0%
   F1 Score:  0.0%

Val:
   ROC AUC:   nan%
   Precision: 0.0%
   Recall:    0.0%
   F1 Score:  0.0%

Test:
   ROC AUC:   66.8%
   Precision: 0.0%
   Recall:    0.0%
   F1 Score:  0.0%

================================================================================
ğŸ“Š MODEL COMPARISON
================================================================================

Validation Set:
   Baseline:  nan% ROC AUC
   Enhanced:  nan% ROC AUC
   Improvement: +nan%

Test Set:
   Baseline:  46.0% ROC AUC
   Enhanced:  66.8% ROC AUC
   Improvement: +20.8%


================================================================================
ğŸ“Š TOP 20 FEATURES (ENHANCED MODEL)
================================================================================

Top 20 features:
    1. volatility_20d                                  337  ğŸ“ˆ TECHNICAL
    3. price_vs_sma200                                 103  ğŸ“ˆ TECHNICAL
   83. vix3m_percentile                                 66  ğŸ“Š OPTIONS
   33. dxy_momentum_5d                                  53  ğŸ“ˆ TECHNICAL
   19. bb_width_percentile                              39  ğŸ“ˆ TECHNICAL
   46. vix_term_structure                               32  ğŸ“ˆ TECHNICAL
   12. adx                                              31  ğŸ“ˆ TECHNICAL
   78. otm_put_itm_call_ratio                           28  ğŸ“Š OPTIONS
   39. vix_momentum_3d                                  21  ğŸ“ˆ TECHNICAL
   49. vvix_level                                       16  ğŸ“ˆ TECHNICAL
   34. dxy_momentum_10d                                 15  ğŸ“ˆ TECHNICAL
    5. return_50d                                       14  ğŸ“ˆ TECHNICAL
   28. macd_histogram                                   13  ğŸ“ˆ TECHNICAL
   76. put_call_premium_ratio                           13  ğŸ“Š OPTIONS
   50. vvix_percentile_252d                              9  ğŸ“ˆ TECHNICAL
    7. xlv_vs_xlk                                        7  ğŸ“ˆ TECHNICAL
   10. rsp_vs_spy                                        6  ğŸ“ˆ TECHNICAL
   77. itm_put_otm_call_ratio                            0  ğŸ“Š OPTIONS
   57. iv_skew_10d                                       0  ğŸ“Š OPTIONS
   61. iv_smile_curvature                                0  ğŸ“Š OPTIONS

âœ… Options features in top 20: 6/20

================================================================================
ğŸ’¾ SAVING MODELS
================================================================================

âœ… Saved baseline model: models/trained/early_warning_baseline.txt
âœ… Saved enhanced model: models/trained/early_warning_enhanced.txt
âœ… Saved feature config: models/trained/early_warning_features.json

================================================================================
âœ… TRAINING COMPLETE
================================================================================

ğŸ‰ OPTIONS FEATURES IMPROVED MODEL BY +20.8% ROC AUC!
   Baseline:  46.0%
   Enhanced:  66.8%

ğŸ“Š Next steps:
   - Analyze feature importance
   - Check for data quality issues in options features
   - Consider feature engineering improvements

