================================================================================
ðŸ”§ RETRAINING WITH REDUCED VOLATILITY WEIGHTING
================================================================================

Strategy:
  1. Scale down volatility features by 0.5x
  2. Create interaction features (volatility * price momentum)
  3. Add trend confirmation features
  4. Retrain with adjusted feature set

================================================================================
STEP 1: LOADING DATA
================================================================================

ðŸ“¥ Loading SPY data from 2000-01-01 to 2024-12-31...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $50.09 - $600.51
âœ… Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
âœ… SPY data loaded: 6288 records
ðŸ“¥ Loading 10 sector ETFs...
   Loading XLU (Utilities)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $6.84 - $80.56
âœ… Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   âœ… XLU loaded
   Loading XLK (Technology)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $8.64 - $239.92
âœ… Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   âœ… XLK loaded
   Loading XLV (Healthcare)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $14.91 - $153.91
âœ… Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   âœ… XLV loaded
   Loading XLF (Financials)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $3.71 - $50.60
âœ… Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   âœ… XLF loaded
   Loading XLE (Energy)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $10.51 - $94.14
âœ… Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   âœ… XLE loaded
   Loading XLI (Industrials)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $11.10 - $141.81
âœ… Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   âœ… XLI loaded
   Loading XLY (Consumer Discretionary)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $13.03 - $237.40
âœ… Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   âœ… XLY loaded
   Loading XLP (Consumer Staples)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $10.06 - $81.62
âœ… Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   âœ… XLP loaded
   Loading XLB (Materials)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $9.79 - $95.72
âœ… Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   âœ… XLB loaded
   Loading XLRE (Real Estate)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $19.51 - $45.64
âœ… Data validation passed: 2322 records from 2015-10-08 to 2024-12-30
   âœ… XLRE loaded
âœ… Loaded 10/10 sector ETFs
ðŸ“¥ Loading 4 rotation indicators...
   Loading MAGS (Magnificent 7)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $24.00 - $57.79
âœ… Data validation passed: 434 records from 2023-04-11 to 2024-12-30
   âœ… MAGS loaded
   Loading RSP (Equal Weight S&P 500)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $15.64 - $184.51
âœ… Data validation passed: 5454 records from 2003-05-01 to 2024-12-30
   âœ… RSP loaded
   Loading QQQ (Nasdaq 100)...
ðŸ” Validating data source: yfinance
   âŒ Failed to load QQQ: âŒ FORBIDDEN: Unrealistic price range 16.97-535.28 for ROTATION_ETF (expected 10-500)
   âš ï¸  Continuing without QQQ
   Loading QQQE (Equal Weight Nasdaq 100)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $15.12 - $95.64
âœ… Data validation passed: 3215 records from 2012-03-21 to 2024-12-30
   âœ… QQQE loaded
âœ… Loaded 3/4 rotation indicators
ðŸ’± Loading currency data...
   Loading USDJPY (JPY=X)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $75.74 - $161.62
âœ… Data validation passed: 6492 records from 2000-01-03 to 2024-12-30
   âœ… USDJPY loaded
   Loading EURUSD (EURUSD=X)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $0.96 - $1.60
âœ… Data validation passed: 5472 records from 2003-12-01 to 2024-12-30
   âœ… EURUSD loaded
   Loading DXY (UUP)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $18.08 - $29.37
âœ… Data validation passed: 4490 records from 2007-03-01 to 2024-12-30
   âœ… DXY loaded
âœ… Loaded 3/3 currency pairs
ðŸ“Š Loading volatility data...
   Loading VIX (^VIX)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $9.14 - $82.69
âœ… Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   âœ… VIX loaded
   Loading VIX9D (^VIX9D)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $7.10 - $106.66
âœ… Data validation passed: 3521 records from 2011-01-03 to 2024-12-30
   âœ… VIX9D loaded
   Loading VVIX (^VVIX)...
ðŸ” Validating data source: yfinance
   ðŸ“Š Price range: $59.74 - $207.59
âœ… Data validation passed: 4520 records from 2007-01-03 to 2024-12-30
   âœ… VVIX loaded
âœ… Loaded 3/3 volatility indices
âœ… Loaded options features

================================================================================
STEP 2: CREATING FEATURES WITH REDUCED VOLATILITY WEIGHTING
================================================================================

================================================================================
ðŸ”§ CALCULATING FEATURES
================================================================================
Feature sets: baseline, currency, volatility
ðŸ“Š Calculating baseline features...
   âœ… Rotation indicators: 3 features
   âœ… Regime detection: 11 features
   âœ… Momentum exhaustion: 9 features
   âœ… Baseline features: 31
ðŸ’± Calculating currency features...
   âœ… Currency features: 12
ðŸ“Š Calculating volatility features...
   âœ… Volatility features: 19
ðŸ§¹ Cleaning features...
   Dropped 20 rows with missing critical features
   âœ… Clean data: 6268 records with 62 features
================================================================================
âœ… FEATURE CALCULATION COMPLETE: 62 features
================================================================================
âœ… Added 30 options features

================================================================================
STEP 3: ADJUSTING FEATURE WEIGHTS
================================================================================

ðŸ“‰ Scaling down volatility features by 0.5x:
   âœ… Scaled: vix_spike
   âœ… Scaled: vix_regime
   âœ… Scaled: vix_term_structure
   âœ… Scaled: vix_backwardation
   âœ… Scaled: vix_percentile
   âœ… Scaled: bb_width
   âœ… Scaled: bb_width_percentile
   âœ… Scaled: bb_squeeze
   âœ… Scaled: bb_expansion

ðŸ“Š Creating interaction features:
   âœ… bb_width_distance_interaction

ðŸ“ˆ Creating trend confirmation features:
   âœ… trend_strength

================================================================================
STEP 4: CREATING TARGET
================================================================================

ðŸŽ¯ Creating Early Warning Target
   Drawdown threshold: 2.0%
   Lead time: 3-5 days
   Lookforward window: 5 days
ðŸŽ¯ EARLY_WARNING TARGET CREATED
   Total samples: 6,263
   Positive samples: 2,307 (36.8%)
   Negative samples: 3,956 (63.2%)
   Class balance: 0.58 (1.0 = perfect balance)

================================================================================
STEP 5: PREPARING TRAINING DATA
================================================================================

Training: 5767 samples (37.8% positive)
Validation: 250 samples (26.8% positive)
Test: 246 samples (23.6% positive)

================================================================================
STEP 6: TRAINING MODEL
================================================================================

[LightGBM] [Info] Number of positive: 2182, number of negative: 3585
[LightGBM] [Info] Auto-choosing col-wise multi-threading, the overhead of testing was 0.001965 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 14505
[LightGBM] [Info] Number of data points in the train set: 5767, number of used features: 74
[LightGBM] [Info] [binary:BoostFromScore]: pavg=0.378360 -> initscore=-0.496517
[LightGBM] [Info] Start training from score -0.496517
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
[LightGBM] [Warning] No further splits with positive gain, best gain: -inf
âœ… Training complete (stopped at 14 iterations)

================================================================================
STEP 7: EVALUATING MODEL
================================================================================

ðŸ“Š Test Set Performance:
   ROC AUC: 47.1%
   Precision: 20.3%
   Recall: 24.1%
   F1 Score: 22.0%

ðŸ“Š Confusion Matrix:
   True Negatives:  133
   False Positives: 55
   False Negatives: 44
   True Positives:  14
   False Positive Rate: 29.3%

================================================================================
STEP 8: FEATURE IMPORTANCE
================================================================================

Top 20 Most Important Features:
   vix_level                                    39.0
   usdjpy_level                                 36.0
   volatility_20d                               25.0
   macd_histogram                               25.0
   atr_14                                       23.0
   rsp_vs_spy                                   17.0
   macd_signal                                  16.0
   price_vs_sma200                              15.0
   macd                                         13.0
   bb_width                                     11.0
   vix3m_percentile                             10.0
   vvix_percentile_252d                         10.0
   vix_percentile_252d                          10.0
   usdjpy_volatility                            10.0
   vix_momentum_5d                               9.0
   vix_term_structure                            8.0
   bb_width_percentile                           8.0
   bb_width_distance_interaction                 7.0
   return_50d                                    7.0
   adx                                           7.0

ðŸ“Š Volatility Features:
   Total importance: 7.3% (down from ~60%)

================================================================================
STEP 9: SAVING MODEL
================================================================================

âœ… Model saved to: models/trained/early_warning_reduced_volatility.txt
âœ… Config saved to: models/trained/early_warning_reduced_volatility_config.json

================================================================================
âœ… RETRAINING COMPLETE
================================================================================

Changes Made:
  1. âœ… Scaled volatility features by 0.5x
  2. âœ… Added interaction features (volatility * price action)
  3. âœ… Added trend confirmation features

Results:
  ROC AUC: 47.1%
  False Positive Rate: 29.3%
  Volatility feature importance: 7.3% (target: <40%)

Next Steps:
  1. Run predictions on 2025 data
  2. Compare false positive rate with original model
  3. Visualize new signals
