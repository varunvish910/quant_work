================================================================================
🔧 RETRAINING WITH FEATURE PENALTIES & REGULARIZATION
================================================================================

Strategy:
  1. Use original features (no scaling)
  2. Add L1/L2 regularization to reduce overfitting
  3. Increase min_gain_to_split (require stronger evidence)
  4. Increase min_child_samples (prevent volatility spike overfitting)
  5. Lower learning rate for more careful learning

================================================================================
STEP 1: LOADING DATA
================================================================================

📥 Loading SPY data from 2000-01-01 to 2024-12-31...
🔍 Validating data source: yfinance
   📊 Price range: $50.09 - $600.51
✅ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
✅ SPY data loaded: 6288 records
📥 Loading 10 sector ETFs...
   Loading XLU (Utilities)...
🔍 Validating data source: yfinance
   📊 Price range: $6.84 - $80.56
✅ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ✅ XLU loaded
   Loading XLK (Technology)...
🔍 Validating data source: yfinance
   📊 Price range: $8.64 - $239.92
✅ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ✅ XLK loaded
   Loading XLV (Healthcare)...
🔍 Validating data source: yfinance
   📊 Price range: $14.91 - $153.91
✅ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ✅ XLV loaded
   Loading XLF (Financials)...
🔍 Validating data source: yfinance
   📊 Price range: $3.71 - $50.60
✅ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ✅ XLF loaded
   Loading XLE (Energy)...
🔍 Validating data source: yfinance
   📊 Price range: $10.51 - $94.14
✅ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ✅ XLE loaded
   Loading XLI (Industrials)...
🔍 Validating data source: yfinance
   📊 Price range: $11.10 - $141.81
✅ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ✅ XLI loaded
   Loading XLY (Consumer Discretionary)...
🔍 Validating data source: yfinance
   📊 Price range: $13.03 - $237.40
✅ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ✅ XLY loaded
   Loading XLP (Consumer Staples)...
🔍 Validating data source: yfinance
   📊 Price range: $10.06 - $81.62
✅ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ✅ XLP loaded
   Loading XLB (Materials)...
🔍 Validating data source: yfinance
   📊 Price range: $9.79 - $95.72
✅ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ✅ XLB loaded
   Loading XLRE (Real Estate)...
🔍 Validating data source: yfinance
   📊 Price range: $19.51 - $45.64
✅ Data validation passed: 2322 records from 2015-10-08 to 2024-12-30
   ✅ XLRE loaded
✅ Loaded 10/10 sector ETFs
📥 Loading 4 rotation indicators...
   Loading MAGS (Magnificent 7)...
🔍 Validating data source: yfinance
   📊 Price range: $24.00 - $57.79
✅ Data validation passed: 434 records from 2023-04-11 to 2024-12-30
   ✅ MAGS loaded
   Loading RSP (Equal Weight S&P 500)...
🔍 Validating data source: yfinance
   📊 Price range: $15.64 - $184.51
✅ Data validation passed: 5454 records from 2003-05-01 to 2024-12-30
   ✅ RSP loaded
   Loading QQQ (Nasdaq 100)...
🔍 Validating data source: yfinance
   ❌ Failed to load QQQ: ❌ FORBIDDEN: Unrealistic price range 16.96-535.28 for ROTATION_ETF (expected 10-500)
   ⚠️  Continuing without QQQ
   Loading QQQE (Equal Weight Nasdaq 100)...
🔍 Validating data source: yfinance
   📊 Price range: $15.12 - $95.64
✅ Data validation passed: 3215 records from 2012-03-21 to 2024-12-30
   ✅ QQQE loaded
✅ Loaded 3/4 rotation indicators
💱 Loading currency data...
   Loading USDJPY (JPY=X)...
🔍 Validating data source: yfinance
   📊 Price range: $75.74 - $161.62
✅ Data validation passed: 6492 records from 2000-01-03 to 2024-12-30
   ✅ USDJPY loaded
   Loading EURUSD (EURUSD=X)...
🔍 Validating data source: yfinance
   📊 Price range: $0.96 - $1.60
✅ Data validation passed: 5472 records from 2003-12-01 to 2024-12-30
   ✅ EURUSD loaded
   Loading DXY (UUP)...
🔍 Validating data source: yfinance
   📊 Price range: $18.08 - $29.37
✅ Data validation passed: 4490 records from 2007-03-01 to 2024-12-30
   ✅ DXY loaded
✅ Loaded 3/3 currency pairs
📊 Loading volatility data...
   Loading VIX (^VIX)...
🔍 Validating data source: yfinance
   📊 Price range: $9.14 - $82.69
✅ Data validation passed: 6288 records from 2000-01-03 to 2024-12-30
   ✅ VIX loaded
   Loading VIX9D (^VIX9D)...
🔍 Validating data source: yfinance
   📊 Price range: $7.10 - $106.66
✅ Data validation passed: 3521 records from 2011-01-03 to 2024-12-30
   ✅ VIX9D loaded
   Loading VVIX (^VVIX)...
🔍 Validating data source: yfinance
   📊 Price range: $59.74 - $207.59
✅ Data validation passed: 4520 records from 2007-01-03 to 2024-12-30
   ✅ VVIX loaded
✅ Loaded 3/3 volatility indices
✅ Loaded options features

================================================================================
STEP 2: CREATING FEATURES (ORIGINAL, NO SCALING)
================================================================================

================================================================================
🔧 CALCULATING FEATURES
================================================================================
Feature sets: baseline, currency, volatility
📊 Calculating baseline features...
   ✅ Rotation indicators: 3 features
   ✅ Regime detection: 11 features
   ✅ Momentum exhaustion: 9 features
   ✅ Baseline features: 31
💱 Calculating currency features...
   ✅ Currency features: 12
📊 Calculating volatility features...
   ✅ Volatility features: 19
🧹 Cleaning features...
   Dropped 20 rows with missing critical features
   ✅ Clean data: 6268 records with 62 features
================================================================================
✅ FEATURE CALCULATION COMPLETE: 62 features
================================================================================
✅ Added 30 options features

================================================================================
STEP 3: CREATING TARGET
================================================================================

🎯 Creating Early Warning Target
   Drawdown threshold: 2.0%
   Lead time: 3-5 days
   Lookforward window: 5 days
🎯 EARLY_WARNING TARGET CREATED
   Total samples: 6,263
   Positive samples: 2,307 (36.8%)
   Negative samples: 3,956 (63.2%)
   Class balance: 0.58 (1.0 = perfect balance)

================================================================================
STEP 4: PREPARING TRAINING DATA
================================================================================

Training: 5767 samples (37.8% positive)
Validation: 250 samples (26.8% positive)
Test: 246 samples (23.6% positive)

================================================================================
STEP 5: TRAINING MODEL WITH REGULARIZATION
================================================================================

Model Configuration:
  - learning_rate: 0.01 (slower, more careful)
  - lambda_l1: 0.5 (L1 regularization)
  - lambda_l2: 0.5 (L2 regularization)
  - min_gain_to_split: 0.1 (require stronger evidence)
  - min_child_samples: 50 (prevent overfitting to spikes)
  - max_depth: 4 (shallower trees)

✅ Training complete (stopped at 148 iterations)

================================================================================
STEP 6: EVALUATING MODEL
================================================================================

📊 Test Set Performance:
   ROC AUC: 65.8%
   Precision: 57.6%
   Recall: 32.8%
   F1 Score: 41.8%

📊 Confusion Matrix:
   True Negatives:  174
   False Positives: 14
   False Negatives: 39
   True Positives:  19
   False Positive Rate: 7.4%

================================================================================
STEP 7: FEATURE IMPORTANCE
================================================================================

Top 20 Most Important Features:
   vix_level                                   200.0
   usdjpy_level                                158.0
   volatility_20d                              149.0
   atr_14                                      119.0
   macd_histogram                              101.0
   bb_width_percentile                          79.0
   price_vs_sma200                              65.0
   vix3m_percentile                             63.0
   rsp_vs_spy                                   56.0
   vix_momentum_3d                              55.0
   bb_width                                     51.0
   realized_vol_20d                             47.0
   macd                                         46.0
   vix_percentile_252d                          46.0
   xlu_vs_xlk                                   41.0
   macd_signal                                  40.0
   dxy_rsi                                      39.0
   adx                                          37.0
   dxy_level                                    34.0
   vix_momentum_5d                              33.0

📊 Volatility Features:
   Total importance: 25.8%

================================================================================
STEP 8: SAVING MODEL
================================================================================

✅ Model saved to: models/trained/early_warning_regularized.txt
✅ Config saved to: models/trained/early_warning_regularized_config.json

================================================================================
✅ RETRAINING COMPLETE
================================================================================

Changes Made:
  1. ✅ Added L1/L2 regularization (0.5 each)
  2. ✅ Increased min_gain_to_split (0.1)
  3. ✅ Increased min_child_samples (50)
  4. ✅ Reduced learning rate (0.01)
  5. ✅ Shallower trees (max_depth=4)

Results:
  ROC AUC: 65.8%
  False Positive Rate: 7.4%
  Volatility feature importance: 25.8%

Next Steps:
  1. Run predictions on 2025 data
  2. Compare false positive rate with original model
  3. Visualize new signals
